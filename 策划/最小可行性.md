《小动物自走棋》最小可行性（MVP）策划

一、产品愿景
- 目标：用最少的系统实现可循环游玩的“回合购卡 + 自动战斗”体验，验证数值框架与内容管线（Luban + Excel）的可用性。
- 风格：轻量、快节奏、可连续多局游玩，单局时长≤10分钟。

二、核心循环（Shop → 阵容 → 战斗 → 结算）
- 回合开始：玩家获得金币，打开商店，进行购买/售卖/刷新。
- 阵容管理：将购买的动物上阵（最多N个），可给动物喂食物或装备。
- 战斗阶段：双方阵容自动对战，依据站位与触发顺序结算。
- 回合结算：胜/负/平，调整生命或积分，进入下一回合。

三、MVP范围与裁剪
1) 商店（Shop.xlsx / ShopTable）
- 卡池与条目：使用 `EEntryType` 仅启用 Unit、Food、Equipment 三类；按 `ETier` 与 `minTurn/maxTurn` 控制投放。
- 格位：商店槽位=4。
- 刷新：手动刷新消耗1金币；每回合开始自动免费刷新一次。
- 冻结：不做（MVP裁剪）。
- 价格：`buyCost` 由表驱动；动物默认3，食物2，装备3（可在表内调整）。
- 权重：同 Tier 内依据 `weight` 抽取。

2) 经济与回合
- 初始金币：10；每回合基础金币=10，硬上限=10（不做存利息）。
- 刷新价格：1；售卖返还：使用 `Units.xlsx` 中 `sellRefund` 字段（建议默认1）。
- 回合数：至少10回合；随回合提升解锁更高 `ETier`（例如：回合1-2=Tier1，3-4=Tier2，5-6=Tier3，7-8=Tier4，9-10=Tier5，>10=Tier6）。

3) 阵容与站位
- 上阵槽位：5 个（前→后顺序）。
- 替补与拖拽：MVP不做替补区；仅允许将场上动物互换位置。
- 阵营：沿用代码 `EFaction`（Ally/Enemy）；战斗生成镜像敌方阵容用于验证对战。

4) 战斗规则（简化版）
- 出手顺序：双方最前排单位轮流攻击（A先手→B→A→…）。
- 攻击与反击：普通攻击造成等于攻击力的伤害；被攻击方不反击（MVP裁剪反击/穿透）。
- 生命与死亡：生命≤0时触发 OnFaint，移除战场。
- 胜负判定：一方全灭则对方胜；同时全灭为平局。
- 触发窗口（按顺序）：
  1) StartOfBattle（上阵单位在战斗开始时各自触发）
  2) OnBeforeAttack（当前出手单位）
  3) OnAttack（造成伤害后）
  4) OnHurt（受击单位被扣血时）
  5) OnFaint（单位死亡时）
  6) EndOfTurn（战斗结束后在结算阶段触发一次）

5) 技能系统（Abilities.xlsx / AbilityTable）
- 触发（EAbilityTrigger）：MVP启用 OnBuy、StartOfBattle、OnBeforeAttack、OnAttack、OnHurt、OnFaint、EndOfTurn。
- 动作（EAbilityAction）：MVP启用 ModifyStats、DealDamage、Heal（其余动作先不做）。
- 持续（EEffectDuration）：支持 Instant 与 Battle（Permanent 可用于食物的永久数值）。
- 目标筛选：支持 `ESide`=Self/Ally/Enemy，`EScope`=Single/RandomN/FrontMost/All（优先 Single、RandomN）。
- 参数：复用 `schema.ts` 中 Ability 的 `conditions/targeting/params` JSON 字段（MVP只做必要键，如 {value, n} 等）。

6) 内容与数值（Units/Foods/Equipments）
- 动物：每个动物包含 `baseAtk/baseHp/abilityId/rarity/tags`，建议先做10种左右，用于1-3阶递进。
- 食物：提供简单的 +攻击/+生命（Permanent）与一次性治疗（Instant）。
- 装备：提供战斗内的临时增益（Battle），如 +攻击力 或 开场加护盾（可用 Heal/ModifyStats 近似）。
- 稀有度（ERarity）：影响商店内相对权重；MVP仅做 Common/Uncommon/Rare。

四、数据驱动与管线
- 表结构：沿用 `excels/datas/*.xlsx` 与 `assets/resources/excel_gen/*.bytes`；运行 `excels/导表.sh` 生成并由 `assets/script/ExcelGen/schema.ts` 读取。
- 资源命名：`displayName/description/token` 由表驱动，后续接入本地化（已预留 `l10n/texts.json`）。
- 运行时装载：通过 `Tables.getTableNames()` 依序加载 `unittable/abilitytable/shoptable/foodtable/equipmenttable`。

五、UI/UX（MVP）
- Loading：沿用现有 `EUIWindow.Loading`。
- 主界面：一个简化“商店 + 阵容条”界面即可（文本/占位图）。
- 交互：
  - 点击商店卡牌→购买（若金币不足则提示）。
  - 拖动动物在5个上阵位之间换位。
  - 刷新按钮（-1金币）。
  - 开始战斗按钮（进入自动战斗）。

六、胜负与进度
- 生命值：玩家初始生命=10；胜利不变，失败-1，平局-0（或双方-1，二选一，MVP期间任选其一）。生命归零则本局结束。
- 赛后：返回商店，回合+1，发放金币并按回合解锁更高Tier。

七、落地到现有代码的映射
- 阵营：使用 `assets/script/Common/Enums.ts:EFaction` 标注队伍。
- 表读取：直接使用 `assets/script/ExcelGen/schema.ts` 的 `Tables` 容器与各 `*Table`。
- 界面：在 `UIManager` 中扩展一个简单的主界面窗口（后续新增 `EUIWindow.Shop`）。
- 模型：在 `assets/script/Model/GameModel.ts` 持有回合数、金币、生命、阵容槽位数组与引用到表数据的轻量实例。

八、测试用例（验收标准）
- 商店：回合1仅出现 Tier1；切到回合3可出现 Tier2；刷新扣1金币；购买扣对应 `buyCost`；售卖返还 `sellRefund`。
- 阵容：最多5只动物；可互换站位；战斗开始后阵容被锁定到本场结束。
- 技能：
  - OnBuy: 购买时+1攻击（ModifyStats +1, Permanent）。
  - StartOfBattle: 对随机敌人造成2点伤害（DealDamage 2, RandomN=1, Instant）。
  - OnFaint: 友军全体+1/+1（ModifyStats +1/+1, Ally, All, Battle）。
- 战斗：最前排轮流出手；受击单位扣血；死亡触发 OnFaint；一方全灭即结束。
- 结算：失败-1生命；进入下一回合获得10金币并自动刷新商店。

九、范围外（MVP不做）
- 合成/升星、宠物进化、复杂站位技能（拉/推/换位）、召唤、装备耐久/独特效果、冻结商店、利息与存钱、PVP匹配与网络、皮肤与美术资源完善。

十、里程碑
- M1（1-2天）：商店与经济（购买/售卖/刷新/回合解锁Tier）。
- M2（1-2天）：阵容上阵与战斗框架（最前排轮流攻击，死亡/胜负判定）。
- M3（1-2天）：触发系统（OnBuy/StartOfBattle/OnFaint/OnAttack/OnHurt 的最小子集）与三类动作（ModifyStats/DealDamage/Heal）。
- M4（1天）：打磨UI/UX、基础数值打样（10只动物、5个食物、3件装备），回归测试与问题清单。

附：表设计对照（用于填表时对齐）
- Units.xlsx：unitId | packId | displayName | description | baseAtk | baseHp | abilityId | sellRefund | rarity | tags[] | token
- Abilities.xlsx：id | trigger(EAbilityTrigger) | perBattleCap | chance | action(EAbilityAction) | conditions(json) | targeting(json) | params(json)
- Shop.xlsx：id | packId | entryType(EEntryType) | tier(ETier) | buyCost | weight | minTurn | maxTurn | limitPerGame | enabled
- Foods.xlsx：id | packId | displayName | description | tier | rarity | abilityId
- Equipments.xlsx：id | packId | displayName | description | tier | rarity | abilityId
